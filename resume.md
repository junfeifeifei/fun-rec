# 天池新闻推荐系统复盘材料（点击行为预测）

## 1) 简历一句话
基于天池“新闻推荐场景下的用户行为预测挑战赛”数据，复盘实现新闻推荐系统全流程：点击日志清洗与特征工程、多路召回（ItemCF/Embedding/YouTubeDNN/冷启动）、粗排/精排（LGBM、DIN）与重排思路，并能说明 MRR 评测与线上提交格式。

## 2) 5-10 分钟讲稿
这个项目以天池新闻推荐赛题为背景，目标是预测用户“最后一次点击的新闻”，并输出 Top-5 推荐列表。我把整个推荐系统拆成召回、粗排、精排、重排四个阶段来复盘，并明确每一阶段的输入输出。

数据来自新闻 APP 的用户点击日志与文章元数据，包括用户点击序列、文章类别、发布时间、字数，以及 250 维文章内容向量。官方描述中数据规模约 30 万用户、近 300 万点击、36 万文章；我本地数据集中训练集约 111 万条点击、20 万用户，测试 A 约 52 万条点击、5 万用户。

召回阶段采用多路召回并行：ItemCF 基于共现与时间/位置权重，Embedding/FAISS 进行内容相似检索，YouTubeDNN 学习用户与文章向量，辅以冷启动规则（类别、字数、时间差）。各路召回做归一化与加权融合，形成候选集。

粗排阶段用召回分数或轻量模型做快速筛选，控制候选规模。精排阶段使用 LGBM Ranker/Classifier 与 DIN，结合用户画像、文章画像、序列兴趣与交互特征，预测点击概率并输出排序分。重排阶段理解 list-wise 优化思路（PRM/PRS）。

评测采用官方 MRR@5，离线评估关注 hit-rate/recall@K、AUC/gAUC、NDCG 等。项目重点是流程复盘与实现细节梳理，结果部分引用公开方案作为参考基线。

## 3) 面试细节与可能追问
### 数据与来源（详细）
- 官方赛题（天池“新闻推荐场景下的用户行为预测挑战赛”）：来自新闻 APP 行为数据，约 30 万用户、近 300 万点击、36 万文章，每篇文章含 250 维 embedding；训练集 20 万用户、测试 A/B 各 5 万用户。
- 本仓库实际数据（`data/dataset/news_recommendation/`）：train_click_log.csv 1,112,623 行 / 200,000 用户；testA_click_log.csv 518,010 行 / 50,000 用户；articles.csv 364,047 行；articles_emb.csv 364,047 行（250 维向量）。
- 点击日志字段：user_id、click_article_id、click_timestamp（毫秒）、click_environment、click_deviceGroup、click_os、click_country、click_region、click_referrer_type。
- 文章字段：article_id、category_id、created_at_ts、words_count；embedding 文件为 article_id + emb_0..emb_249。
- 提交格式：user_id + top-5 article_id（sample_submit.csv 在官方数据中提供）。

### 任务与评测
- 任务目标：根据用户历史点击预测“最后一次点击的新闻”，为每个用户输出 top-5。
- 评分方式：MRR@5，score(user) = sum_{k=1..5} s(user,k)/k，最终取用户平均。
- 数据切分：训练集 + 测试 A（公开），测试 B 作为线上隐藏评估。

### 系统流程与实现要点
- 数据处理：按时间排序用户行为，提取最后一次点击作为标签，历史行为构造序列与统计特征，避免泄漏。
- 召回：ItemCF（共现 + 时间/位置/创建时间权重）、Embedding 相似检索（FAISS）、YouTubeDNN、UserCF；冷启动按类别/字数/时间差规则补充。
- 召回融合：各路分数归一化后加权求和，去重截断到 topK。
- 粗排：使用召回分或轻量模型快速筛选候选，降低精排成本。
- 精排：LGBM Ranker/Classifier + DIN，建模用户画像、文章画像、序列兴趣与交叉特征。
- 重排：理解 PRM/PRS 的 list-wise 优化思路，用于列表级指标优化。

### Baseline 与结果（公开参考）
- 官方指标为 MRR@5；公开方案参考（GitHub: CompetitionTianChi_newsRecommendation）显示：swing 召回得分约 0.18，LGBM 排序 HR@5≈0.27、HR@50≈0.49，B 榜排名 5/5338。
- 本项目以流程复盘为主，未进行完整线上训练与提交，成绩用于对标参考而非本人实测。

### 常见追问（Q/A）
- Q: 数据都是新闻吗？A: 是新闻 APP 的点击与文章属性数据，点击日志 + 文章元数据 + 文章 embedding。
- Q: 为什么用“最后一次点击”做标签？A: 任务定义即预测未来一次点击，最后一次点击可视为下一步行为的监督信号。
- Q: 如何避免数据泄漏？A: 仅用历史点击构造特征，最后一次点击不参与历史序列。
- Q: 多路召回为什么必要？A: 单路召回覆盖不足，多路召回提高覆盖率与多样性，再由精排统一建模。
- Q: 召回融合怎么做？A: 先对每路分数归一化，再按权重加权求和并截断。
- Q: 负采样策略？A: 对负样本下采样，保持用户/物品覆盖，并控制每个用户负样本数。
- Q: 精排特征有哪些？A: 用户活跃度、设备/时间偏好、物品热度、类别与字数、相似度统计、时间差/字数差等。
- Q: DIN 为什么适合？A: 注意力机制突出与候选文章相关的历史行为，更好建模短期兴趣。
- Q: 冷启动怎么处理？A: 结合内容向量相似度与规则过滤（类别/时间/字数），避免纯协同过滤失效。
- Q: 粗排和精排的差别？A: 粗排更轻量、以缩小候选为主；精排特征更全、模型更重。
- Q: 系统是完整线上服务吗？A: 以离线建模与评测为主的学习型项目，未包含在线服务部署。
